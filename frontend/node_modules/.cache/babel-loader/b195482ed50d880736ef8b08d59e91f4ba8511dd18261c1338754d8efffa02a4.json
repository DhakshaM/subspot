{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useLocation,useParams,useNavigate}from'react-router-dom';import'./SubscriptionDetails.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL='http://localhost:8000/subspot/';function SubscriptionDetails(){const{id}=useParams();const location=useLocation();const navigate=useNavigate();const{subscription}=location.state||{};const[userInfo,setUserInfo]=useState(null);const[formData,setFormData]=useState({viewing_hours_bucket:'',avg_viewing_duration_bucket:'',content_downloads_bucket:'',support_tickets_bucket:'',user_rating_bucket:'',parental_control:''});const[predictionResult,setPredictionResult]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);useEffect(()=>{fetch(`${API_BASE_URL}auth/user/`,{credentials:'include'}).then(res=>{if(res.status===401){navigate('/');return;}return res.json();}).then(data=>{if(data){setUserInfo({username:data.username,email:data.email});}}).catch(err=>console.error('Error fetching user info:',err));},[navigate]);const handleChange=e=>{setFormData({...formData,[e.target.name]:e.target.value});};const handleSubmit=async()=>{if(!userInfo){setError('User information not loaded. Please try again.');return;}if(Object.values(formData).includes('')){setError('Please select all options before submitting.');return;}setError(null);setLoading(true);const requestData={service_name:subscription.name,username:userInfo.username,...formData};try{const response=await fetch(`${API_BASE_URL}prediction/`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(requestData)});const data=await response.json();if(!response.ok)throw new Error(data.error||'Something went wrong');setPredictionResult(data.prediction);}catch(error){setError(error.message);}finally{setLoading(false);}};if(!subscription){return/*#__PURE__*/_jsx(\"p\",{children:\"Loading subscription details...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"subscription-details\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Subscription Details\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",subscription.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Cost:\"}),\" Rs. \",subscription.cost]}),/*#__PURE__*/_jsx(\"h3\",{children:\"Choose Buckets\"}),[{label:'Viewing Hours',name:'viewing_hours_bucket',options:['Low','Medium','High','Very High']},{label:'Average Viewing Duration',name:'avg_viewing_duration_bucket',options:['Short','Moderate','Long','Very Long']},{label:'Content Downloads Per Month',name:'content_downloads_bucket',options:['Rare','Intermediate','Frequent','Very Frequent']},{label:'Support Tickets Per Month',name:'support_tickets_bucket',options:['Low','Moderate','High','Very High']},{label:'Rating',name:'user_rating_bucket',options:['Poor','Average','Good','Excellent']},{label:'Parental Control',name:'parental_control',options:['Yes','No']}].map(_ref=>{let{label,name,options}=_ref;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{children:[label,\":\"]}),/*#__PURE__*/_jsxs(\"select\",{name:name,onChange:handleChange,value:formData[name],children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),options.map(opt=>/*#__PURE__*/_jsx(\"option\",{value:opt,children:opt},opt))]})]},name);}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,disabled:loading,children:loading?'Predicting...':'Submit'}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"error\",children:error}),predictionResult&&/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-box\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Prediction Result\"}),/*#__PURE__*/_jsx(\"p\",{children:predictionResult})]})]});}export default SubscriptionDetails;","map":{"version":3,"names":["React","useState","useEffect","useLocation","useParams","useNavigate","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","SubscriptionDetails","id","location","navigate","subscription","state","userInfo","setUserInfo","formData","setFormData","viewing_hours_bucket","avg_viewing_duration_bucket","content_downloads_bucket","support_tickets_bucket","user_rating_bucket","parental_control","predictionResult","setPredictionResult","loading","setLoading","error","setError","fetch","credentials","then","res","status","json","data","username","email","catch","err","console","handleChange","e","target","name","value","handleSubmit","Object","values","includes","requestData","service_name","response","method","headers","body","JSON","stringify","ok","Error","prediction","message","children","className","cost","label","options","map","_ref","onChange","opt","onClick","disabled"],"sources":["D:/DESIS ASCEND Educare Program Edition 4 (2024)/Desis Project/subspot/frontend/src/components/SubscriptionDetails.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useLocation, useParams, useNavigate } from 'react-router-dom';\r\nimport './SubscriptionDetails.css';\r\n\r\nconst API_BASE_URL = 'http://localhost:8000/subspot/';\r\n\r\nfunction SubscriptionDetails() {\r\n  const { id } = useParams();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { subscription } = location.state || {};\r\n\r\n  const [userInfo, setUserInfo] = useState(null);\r\n  const [formData, setFormData] = useState({\r\n    viewing_hours_bucket: '',\r\n    avg_viewing_duration_bucket: '',\r\n    content_downloads_bucket: '',\r\n    support_tickets_bucket: '',\r\n    user_rating_bucket: '',\r\n    parental_control: '',\r\n  });\r\n\r\n  const [predictionResult, setPredictionResult] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    fetch(`${API_BASE_URL}auth/user/`, { credentials: 'include' })\r\n      .then((res) => {\r\n        if (res.status === 401) {\r\n          navigate('/'); \r\n          return;\r\n        }\r\n        return res.json();\r\n      })\r\n      .then((data) => {\r\n        if (data) {\r\n          setUserInfo({ username: data.username, email: data.email });\r\n        }\r\n      })\r\n      .catch((err) => console.error('Error fetching user info:', err));\r\n  }, [navigate]);\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({ ...formData, [e.target.name]: e.target.value });\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!userInfo) {\r\n      setError('User information not loaded. Please try again.');\r\n      return;\r\n    }\r\n\r\n    if (Object.values(formData).includes('')) {\r\n      setError('Please select all options before submitting.');\r\n      return;\r\n    }\r\n\r\n    setError(null);\r\n    setLoading(true);\r\n\r\n    const requestData = {\r\n      service_name: subscription.name,\r\n      username: userInfo.username,\r\n      ...formData,\r\n    };\r\n\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}prediction/`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(requestData),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (!response.ok) throw new Error(data.error || 'Something went wrong');\r\n\r\n      setPredictionResult(data.prediction);\r\n    } catch (error) {\r\n      setError(error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!subscription) {\r\n    return <p>Loading subscription details...</p>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"subscription-details\">\r\n      <h2>Subscription Details</h2>\r\n      <p><strong>Name:</strong> {subscription.name}</p>\r\n      <p><strong>Cost:</strong> Rs. {subscription.cost}</p>\r\n{/* \r\n      {userInfo && (\r\n        <>\r\n          <h3>User Info</h3>\r\n          <p><strong>Username:</strong> {userInfo.username}</p>\r\n          <p><strong>Email:</strong> {userInfo.email}</p>\r\n        </>\r\n      )} */}\r\n\r\n      <h3>Choose Buckets</h3>\r\n      {[\r\n        { label: 'Viewing Hours', name: 'viewing_hours_bucket', options: ['Low', 'Medium', 'High', 'Very High'] },\r\n        { label: 'Average Viewing Duration', name: 'avg_viewing_duration_bucket', options: ['Short', 'Moderate', 'Long', 'Very Long'] },\r\n        { label: 'Content Downloads Per Month', name: 'content_downloads_bucket', options: ['Rare', 'Intermediate', 'Frequent', 'Very Frequent'] },\r\n        { label: 'Support Tickets Per Month', name: 'support_tickets_bucket', options: ['Low', 'Moderate', 'High', 'Very High'] },\r\n        { label: 'Rating', name: 'user_rating_bucket', options: ['Poor', 'Average', 'Good', 'Excellent'] },\r\n        { label: 'Parental Control', name: 'parental_control', options: ['Yes', 'No'] },\r\n      ].map(({ label, name, options }) => (\r\n        <div key={name}>\r\n          <label>{label}:</label>\r\n          <select name={name} onChange={handleChange} value={formData[name]}>\r\n            <option value=\"\">Select</option>\r\n            {options.map((opt) => (\r\n              <option key={opt} value={opt}>{opt}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      ))}\r\n\r\n      <button onClick={handleSubmit} disabled={loading}>\r\n        {loading ? 'Predicting...' : 'Submit'}\r\n      </button>\r\n\r\n      {error && <p className=\"error\">{error}</p>}\r\n\r\n      {predictionResult && (\r\n        <div className=\"prediction-box\">\r\n          <h3>Prediction Result</h3>\r\n          <p>{predictionResult}</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SubscriptionDetails;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}