{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useLocation,useParams,useNavigate}from'react-router-dom';import'./SubscriptionDetails.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL='http://localhost:8000/subspot/';function SubscriptionDetails(){const{id}=useParams();const location=useLocation();const navigate=useNavigate();const{subscription}=location.state||{};const[userInfo,setUserInfo]=useState(null);const[formData,setFormData]=useState({viewing_hours_bucket:'',avg_viewing_duration_bucket:'',content_downloads_bucket:'',support_tickets_bucket:'',user_rating_bucket:'',parental_control:''});const[predictionResult,setPredictionResult]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);useEffect(()=>{fetch(`${API_BASE_URL}auth/user/`,{credentials:'include'}).then(res=>{if(res.status===401){navigate('/');return;}return res.json();}).then(data=>{if(data){setUserInfo({username:data.username,email:data.email});}}).catch(err=>console.error('Error fetching user info:',err));},[navigate]);const handleChange=e=>{setFormData({...formData,[e.target.name]:e.target.value});};const handleSubmit=async()=>{if(!userInfo){setError('User information not loaded. Please try again.');return;}if(Object.values(formData).includes('')){setError('Please select all options before submitting.');return;}setError(null);setLoading(true);const requestData={service_name:subscription.name,username:userInfo.username,...formData};try{const response=await fetch(`${API_BASE_URL}prediction/`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(requestData)});const data=await response.json();if(!response.ok)throw new Error(data.error||'Something went wrong');setPredictionResult(data.prediction);}catch(error){setError(error.message);}finally{setLoading(false);}};if(!subscription){return/*#__PURE__*/_jsx(\"p\",{children:\"Loading subscription details...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"subscription-details-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"subscription-details\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Subscription Details\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",subscription.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Cost:\"}),\" Rs. \",subscription.cost]}),/*#__PURE__*/_jsx(\"h3\",{children:\"Choose Buckets\"}),[{label:'Viewing Hours',name:'viewing_hours_bucket',options:['Low','Medium','High','Very High']},{label:'Average Viewing Duration',name:'avg_viewing_duration_bucket',options:['Short','Moderate','Long','Very Long']},{label:'Content Downloads Per Month',name:'content_downloads_bucket',options:['Rare','Intermediate','Frequent','Very Frequent']},{label:'Support Tickets Per Month',name:'support_tickets_bucket',options:['Low','Moderate','High','Very High']},{label:'Rating',name:'user_rating_bucket',options:['Poor','Average','Good','Excellent']},{label:'Parental Control',name:'parental_control',options:['Yes','No']}].map(_ref=>{let{label,name,options}=_ref;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{children:[label,\":\"]}),/*#__PURE__*/_jsxs(\"select\",{name:name,onChange:handleChange,value:formData[name],children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),options.map(opt=>/*#__PURE__*/_jsx(\"option\",{value:opt,children:opt},opt))]})]},name);}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,disabled:loading,children:loading?'Predicting...':'Submit'}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"error\",children:error}),predictionResult&&/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-box\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Prediction Result\"}),/*#__PURE__*/_jsx(\"p\",{children:predictionResult})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom-left-ellipse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom-right-ellipse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom-center-ellipse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom-right-red-ellipse\"})]});}export default SubscriptionDetails;","map":{"version":3,"names":["React","useState","useEffect","useLocation","useParams","useNavigate","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","SubscriptionDetails","id","location","navigate","subscription","state","userInfo","setUserInfo","formData","setFormData","viewing_hours_bucket","avg_viewing_duration_bucket","content_downloads_bucket","support_tickets_bucket","user_rating_bucket","parental_control","predictionResult","setPredictionResult","loading","setLoading","error","setError","fetch","credentials","then","res","status","json","data","username","email","catch","err","console","handleChange","e","target","name","value","handleSubmit","Object","values","includes","requestData","service_name","response","method","headers","body","JSON","stringify","ok","Error","prediction","message","children","className","cost","label","options","map","_ref","onChange","opt","onClick","disabled"],"sources":["/home/anmol/DEShaw-Project/subspot/frontend/src/components/SubscriptionDetails.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useLocation, useParams, useNavigate } from 'react-router-dom';\nimport './SubscriptionDetails.css';\n\nconst API_BASE_URL = 'http://localhost:8000/subspot/';\n\nfunction SubscriptionDetails() {\n  const { id } = useParams();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const { subscription } = location.state || {};\n\n  const [userInfo, setUserInfo] = useState(null);\n  const [formData, setFormData] = useState({\n    viewing_hours_bucket: '',\n    avg_viewing_duration_bucket: '',\n    content_downloads_bucket: '',\n    support_tickets_bucket: '',\n    user_rating_bucket: '',\n    parental_control: '',\n  });\n  const [predictionResult, setPredictionResult] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    fetch(`${API_BASE_URL}auth/user/`, { credentials: 'include' })\n      .then((res) => {\n        if (res.status === 401) {\n          navigate('/');\n          return;\n        }\n        return res.json();\n      })\n      .then((data) => {\n        if (data) {\n          setUserInfo({ username: data.username, email: data.email });\n        }\n      })\n      .catch((err) => console.error('Error fetching user info:', err));\n  }, [navigate]);\n\n  const handleChange = (e) => {\n    setFormData({ ...formData, [e.target.name]: e.target.value });\n  };\n\n  const handleSubmit = async () => {\n    if (!userInfo) {\n      setError('User information not loaded. Please try again.');\n      return;\n    }\n    if (Object.values(formData).includes('')) {\n      setError('Please select all options before submitting.');\n      return;\n    }\n    setError(null);\n    setLoading(true);\n    const requestData = {\n      service_name: subscription.name,\n      username: userInfo.username,\n      ...formData,\n    };\n    try {\n      const response = await fetch(`${API_BASE_URL}prediction/`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify(requestData),\n      });\n      const data = await response.json();\n      if (!response.ok) throw new Error(data.error || 'Something went wrong');\n      setPredictionResult(data.prediction);\n    } catch (error) {\n      setError(error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!subscription) {\n    return <p>Loading subscription details...</p>;\n  }\n\n  return (\n    <div className=\"subscription-details-container\">\n      <div className=\"subscription-details\">\n        <h2>Subscription Details</h2>\n        <p><strong>Name:</strong> {subscription.name}</p>\n        <p><strong>Cost:</strong> Rs. {subscription.cost}</p>\n        <h3>Choose Buckets</h3>\n        {[\n          { label: 'Viewing Hours', name: 'viewing_hours_bucket', options: ['Low', 'Medium', 'High', 'Very High'] },\n          { label: 'Average Viewing Duration', name: 'avg_viewing_duration_bucket', options: ['Short', 'Moderate', 'Long', 'Very Long'] },\n          { label: 'Content Downloads Per Month', name: 'content_downloads_bucket', options: ['Rare', 'Intermediate', 'Frequent', 'Very Frequent'] },\n          { label: 'Support Tickets Per Month', name: 'support_tickets_bucket', options: ['Low', 'Moderate', 'High', 'Very High'] },\n          { label: 'Rating', name: 'user_rating_bucket', options: ['Poor', 'Average', 'Good', 'Excellent'] },\n          { label: 'Parental Control', name: 'parental_control', options: ['Yes', 'No'] },\n        ].map(({ label, name, options }) => (\n          <div key={name}>\n            <label>{label}:</label>\n            <select name={name} onChange={handleChange} value={formData[name]}>\n              <option value=\"\">Select</option>\n              {options.map((opt) => (\n                <option key={opt} value={opt}>{opt}</option>\n              ))}\n            </select>\n          </div>\n        ))}\n        <button onClick={handleSubmit} disabled={loading}>\n          {loading ? 'Predicting...' : 'Submit'}\n        </button>\n        {error && <p className=\"error\">{error}</p>}\n        {predictionResult && (\n          <div className=\"prediction-box\">\n            <h3>Prediction Result</h3>\n            <p>{predictionResult}</p>\n          </div>\n        )}\n      </div>\n      {/* Additional background gradient elements */}\n      <div className=\"bottom-left-ellipse\"></div>\n      <div className=\"bottom-right-ellipse\"></div>\n      <div className=\"bottom-center-ellipse\"></div>\n      <div className=\"bottom-right-red-ellipse\"></div>\n    </div>\n  );\n}\n\nexport default SubscriptionDetails;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,WAAW,CAAEC,SAAS,CAAEC,WAAW,KAAQ,kBAAkB,CACtE,MAAO,2BAA2B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEnC,KAAM,CAAAC,YAAY,CAAG,gCAAgC,CAErD,QAAS,CAAAC,mBAAmBA,CAAA,CAAG,CAC7B,KAAM,CAAEC,EAAG,CAAC,CAAGR,SAAS,CAAC,CAAC,CAC1B,KAAM,CAAAS,QAAQ,CAAGV,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAW,QAAQ,CAAGT,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAEU,YAAa,CAAC,CAAGF,QAAQ,CAACG,KAAK,EAAI,CAAC,CAAC,CAE7C,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAGjB,QAAQ,CAAC,IAAI,CAAC,CAC9C,KAAM,CAACkB,QAAQ,CAAEC,WAAW,CAAC,CAAGnB,QAAQ,CAAC,CACvCoB,oBAAoB,CAAE,EAAE,CACxBC,2BAA2B,CAAE,EAAE,CAC/BC,wBAAwB,CAAE,EAAE,CAC5BC,sBAAsB,CAAE,EAAE,CAC1BC,kBAAkB,CAAE,EAAE,CACtBC,gBAAgB,CAAE,EACpB,CAAC,CAAC,CACF,KAAM,CAACC,gBAAgB,CAAEC,mBAAmB,CAAC,CAAG3B,QAAQ,CAAC,IAAI,CAAC,CAC9D,KAAM,CAAC4B,OAAO,CAAEC,UAAU,CAAC,CAAG7B,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAAC8B,KAAK,CAAEC,QAAQ,CAAC,CAAG/B,QAAQ,CAAC,IAAI,CAAC,CAExCC,SAAS,CAAC,IAAM,CACd+B,KAAK,CAAC,GAAGvB,YAAY,YAAY,CAAE,CAAEwB,WAAW,CAAE,SAAU,CAAC,CAAC,CAC3DC,IAAI,CAAEC,GAAG,EAAK,CACb,GAAIA,GAAG,CAACC,MAAM,GAAK,GAAG,CAAE,CACtBvB,QAAQ,CAAC,GAAG,CAAC,CACb,OACF,CACA,MAAO,CAAAsB,GAAG,CAACE,IAAI,CAAC,CAAC,CACnB,CAAC,CAAC,CACDH,IAAI,CAAEI,IAAI,EAAK,CACd,GAAIA,IAAI,CAAE,CACRrB,WAAW,CAAC,CAAEsB,QAAQ,CAAED,IAAI,CAACC,QAAQ,CAAEC,KAAK,CAAEF,IAAI,CAACE,KAAM,CAAC,CAAC,CAC7D,CACF,CAAC,CAAC,CACDC,KAAK,CAAEC,GAAG,EAAKC,OAAO,CAACb,KAAK,CAAC,2BAA2B,CAAEY,GAAG,CAAC,CAAC,CACpE,CAAC,CAAE,CAAC7B,QAAQ,CAAC,CAAC,CAEd,KAAM,CAAA+B,YAAY,CAAIC,CAAC,EAAK,CAC1B1B,WAAW,CAAC,CAAE,GAAGD,QAAQ,CAAE,CAAC2B,CAAC,CAACC,MAAM,CAACC,IAAI,EAAGF,CAAC,CAACC,MAAM,CAACE,KAAM,CAAC,CAAC,CAC/D,CAAC,CAED,KAAM,CAAAC,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/B,GAAI,CAACjC,QAAQ,CAAE,CACbe,QAAQ,CAAC,gDAAgD,CAAC,CAC1D,OACF,CACA,GAAImB,MAAM,CAACC,MAAM,CAACjC,QAAQ,CAAC,CAACkC,QAAQ,CAAC,EAAE,CAAC,CAAE,CACxCrB,QAAQ,CAAC,8CAA8C,CAAC,CACxD,OACF,CACAA,QAAQ,CAAC,IAAI,CAAC,CACdF,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAwB,WAAW,CAAG,CAClBC,YAAY,CAAExC,YAAY,CAACiC,IAAI,CAC/BR,QAAQ,CAAEvB,QAAQ,CAACuB,QAAQ,CAC3B,GAAGrB,QACL,CAAC,CACD,GAAI,CACF,KAAM,CAAAqC,QAAQ,CAAG,KAAM,CAAAvB,KAAK,CAAC,GAAGvB,YAAY,aAAa,CAAE,CACzD+C,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CxB,WAAW,CAAE,SAAS,CACtByB,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACP,WAAW,CAClC,CAAC,CAAC,CACF,KAAM,CAAAf,IAAI,CAAG,KAAM,CAAAiB,QAAQ,CAAClB,IAAI,CAAC,CAAC,CAClC,GAAI,CAACkB,QAAQ,CAACM,EAAE,CAAE,KAAM,IAAI,CAAAC,KAAK,CAACxB,IAAI,CAACR,KAAK,EAAI,sBAAsB,CAAC,CACvEH,mBAAmB,CAACW,IAAI,CAACyB,UAAU,CAAC,CACtC,CAAE,MAAOjC,KAAK,CAAE,CACdC,QAAQ,CAACD,KAAK,CAACkC,OAAO,CAAC,CACzB,CAAC,OAAS,CACRnC,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,GAAI,CAACf,YAAY,CAAE,CACjB,mBAAOR,IAAA,MAAA2D,QAAA,CAAG,iCAA+B,CAAG,CAAC,CAC/C,CAEA,mBACEzD,KAAA,QAAK0D,SAAS,CAAC,gCAAgC,CAAAD,QAAA,eAC7CzD,KAAA,QAAK0D,SAAS,CAAC,sBAAsB,CAAAD,QAAA,eACnC3D,IAAA,OAAA2D,QAAA,CAAI,sBAAoB,CAAI,CAAC,cAC7BzD,KAAA,MAAAyD,QAAA,eAAG3D,IAAA,WAAA2D,QAAA,CAAQ,OAAK,CAAQ,CAAC,IAAC,CAACnD,YAAY,CAACiC,IAAI,EAAI,CAAC,cACjDvC,KAAA,MAAAyD,QAAA,eAAG3D,IAAA,WAAA2D,QAAA,CAAQ,OAAK,CAAQ,CAAC,QAAK,CAACnD,YAAY,CAACqD,IAAI,EAAI,CAAC,cACrD7D,IAAA,OAAA2D,QAAA,CAAI,gBAAc,CAAI,CAAC,CACtB,CACC,CAAEG,KAAK,CAAE,eAAe,CAAErB,IAAI,CAAE,sBAAsB,CAAEsB,OAAO,CAAE,CAAC,KAAK,CAAE,QAAQ,CAAE,MAAM,CAAE,WAAW,CAAE,CAAC,CACzG,CAAED,KAAK,CAAE,0BAA0B,CAAErB,IAAI,CAAE,6BAA6B,CAAEsB,OAAO,CAAE,CAAC,OAAO,CAAE,UAAU,CAAE,MAAM,CAAE,WAAW,CAAE,CAAC,CAC/H,CAAED,KAAK,CAAE,6BAA6B,CAAErB,IAAI,CAAE,0BAA0B,CAAEsB,OAAO,CAAE,CAAC,MAAM,CAAE,cAAc,CAAE,UAAU,CAAE,eAAe,CAAE,CAAC,CAC1I,CAAED,KAAK,CAAE,2BAA2B,CAAErB,IAAI,CAAE,wBAAwB,CAAEsB,OAAO,CAAE,CAAC,KAAK,CAAE,UAAU,CAAE,MAAM,CAAE,WAAW,CAAE,CAAC,CACzH,CAAED,KAAK,CAAE,QAAQ,CAAErB,IAAI,CAAE,oBAAoB,CAAEsB,OAAO,CAAE,CAAC,MAAM,CAAE,SAAS,CAAE,MAAM,CAAE,WAAW,CAAE,CAAC,CAClG,CAAED,KAAK,CAAE,kBAAkB,CAAErB,IAAI,CAAE,kBAAkB,CAAEsB,OAAO,CAAE,CAAC,KAAK,CAAE,IAAI,CAAE,CAAC,CAChF,CAACC,GAAG,CAACC,IAAA,MAAC,CAAEH,KAAK,CAAErB,IAAI,CAAEsB,OAAQ,CAAC,CAAAE,IAAA,oBAC7B/D,KAAA,QAAAyD,QAAA,eACEzD,KAAA,UAAAyD,QAAA,EAAQG,KAAK,CAAC,GAAC,EAAO,CAAC,cACvB5D,KAAA,WAAQuC,IAAI,CAAEA,IAAK,CAACyB,QAAQ,CAAE5B,YAAa,CAACI,KAAK,CAAE9B,QAAQ,CAAC6B,IAAI,CAAE,CAAAkB,QAAA,eAChE3D,IAAA,WAAQ0C,KAAK,CAAC,EAAE,CAAAiB,QAAA,CAAC,QAAM,CAAQ,CAAC,CAC/BI,OAAO,CAACC,GAAG,CAAEG,GAAG,eACfnE,IAAA,WAAkB0C,KAAK,CAAEyB,GAAI,CAAAR,QAAA,CAAEQ,GAAG,EAArBA,GAA8B,CAC5C,CAAC,EACI,CAAC,GAPD1B,IAQL,CAAC,EACP,CAAC,cACFzC,IAAA,WAAQoE,OAAO,CAAEzB,YAAa,CAAC0B,QAAQ,CAAE/C,OAAQ,CAAAqC,QAAA,CAC9CrC,OAAO,CAAG,eAAe,CAAG,QAAQ,CAC/B,CAAC,CACRE,KAAK,eAAIxB,IAAA,MAAG4D,SAAS,CAAC,OAAO,CAAAD,QAAA,CAAEnC,KAAK,CAAI,CAAC,CACzCJ,gBAAgB,eACflB,KAAA,QAAK0D,SAAS,CAAC,gBAAgB,CAAAD,QAAA,eAC7B3D,IAAA,OAAA2D,QAAA,CAAI,mBAAiB,CAAI,CAAC,cAC1B3D,IAAA,MAAA2D,QAAA,CAAIvC,gBAAgB,CAAI,CAAC,EACtB,CACN,EACE,CAAC,cAENpB,IAAA,QAAK4D,SAAS,CAAC,qBAAqB,CAAM,CAAC,cAC3C5D,IAAA,QAAK4D,SAAS,CAAC,sBAAsB,CAAM,CAAC,cAC5C5D,IAAA,QAAK4D,SAAS,CAAC,uBAAuB,CAAM,CAAC,cAC7C5D,IAAA,QAAK4D,SAAS,CAAC,0BAA0B,CAAM,CAAC,EAC7C,CAAC,CAEV,CAEA,cAAe,CAAAxD,mBAAmB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}